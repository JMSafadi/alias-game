<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alias Game</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css"
    />
    <script
      src="https://cdn.socket.io/4.3.2/socket.io.min.js"
      integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs"
      crossorigin="anonymous"
    ></script>
    <script>
      const socket = io('http://localhost:3000/game'); // Inicjalizacja socket

      let currentGameId; // Zmienna, która przechowuje aktualny gameId po utworzeniu gry

      function startGame() {
        const lobbyId = document.getElementById('lobbyId').value;
        const team1Name = document.getElementById('team1Name').value;
        const team1Players = document
          .getElementById('team1Players')
          .value.split(',');
        const team2Name = document.getElementById('team2Name').value;
        const team2Players = document
          .getElementById('team2Players')
          .value.split(',');
        const rounds = parseInt(document.getElementById('rounds').value);
        const timePerTurn = parseInt(
          document.getElementById('timePerTurn').value,
        );

        socket.emit('startGame', {
          lobbyId,
          teamsInfo: [
            { teamName: team1Name, players: team1Players },
            { teamName: team2Name, players: team2Players },
          ],
          rounds,
          timePerTurn,
        });

        socket.on('gameStarted', function (data) {
          console.log('Game started:', data);
          currentGameId = data.game._id; // Zapisz gameId do zmiennej
        });
      }

      function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput ? messageInput.value : '';

        if (!message) {
          alert('Message cannot be empty!');
          return;
        }

        const messageType = document.getElementById('isGuess').checked
          ? 'guess'
          : document.getElementById('isDescribe').checked
            ? 'describe'
            : 'chat';

        const senderTeamName = document.getElementById('senderTeamName').value;

        if (!senderTeamName) {
          alert('Please enter your Team Name!');
          return;
        }

        socket.emit('send_message', {
          content: message,
          sender: socket.id,
          gameId: currentGameId, // Użyj zapisanej zmiennej gameId
          senderTeamName,
          messageType,
        });

        messageInput.value = '';
      }

      socket.on('turnStarted', function (data) {
        console.log('Received turnStarted event data:', data);

        // Aktualizacja informacji w interfejsie
        if (
          data &&
          data.round &&
          data.teamName &&
          data.describer &&
          data.wordToGuess
        ) {
          document.getElementById('currentRound').textContent =
            `Current Round: ${data.round}`;
          document.getElementById('currentTeam').textContent =
            `Current Team: ${data.teamName}`;
          document.getElementById('currentDescriber').textContent =
            `Describer: ${data.describer}`;
          document.getElementById('wordToGuess').textContent =
            `Word to guess: ${data.wordToGuess}`;
        } else {
          console.warn('Received incomplete data for turnStarted:', data);
        }
      });
    </script>
  </head>
  <body>
    <div class="container mt-5">
      <div class="columns">
        <!-- Main Chat Section -->
        <div class="column is-two-thirds">
          <div class="box">
            <h3 class="title is-4">Chat</h3>
            <div
              id="messages"
              style="
                height: 300px;
                overflow-y: scroll;
                border: 1px solid #ccc;
                padding: 10px;
              "
            >
              <!-- Messages will be displayed here -->
            </div>
            <input
              id="messageInput"
              class="input mt-2"
              placeholder="Enter message"
            />
            <div class="mt-2">
              <input type="checkbox" id="isDescribe" />
              <label for="isDescribe">Describe Mode</label>
              <input type="checkbox" id="isGuess" />
              <label for="isGuess">Guess Mode</label>
            </div>
            <div class="mt-2">
              <input
                id="senderTeamName"
                class="input"
                placeholder="Enter your team name"
              />
            </div>
            <button class="button is-link mt-2" onclick="sendMessage()">
              Send
            </button>
          </div>
          <!-- Word to Guess Section -->
          <div class="box mt-5">
            <h3 class="title is-4">Game Info</h3>
            <div id="currentRound" class="has-text-weight-bold mb-3">
              Current Round:
            </div>
            <div id="currentTeam" class="has-text-weight-bold mb-3">
              Current Team:
            </div>
            <div id="currentDescriber" class="has-text-weight-bold mb-3">
              Describer:
            </div>
            <div id="wordToGuess" class="has-text-weight-bold mb-3">
              Word to guess:
            </div>
          </div>
        </div>

        <!-- Setup Game Section -->
        <div class="column">
          <div class="box">
            <h3 class="title is-4">Setup Game</h3>
            <div class="mb-4">
              <label class="label">Lobby ID</label>
              <input id="lobbyId" class="input" placeholder="Enter lobby ID" />
            </div>
            <div class="mb-4">
              <h4 class="subtitle is-6">Team 1</h4>
              <input
                id="team1Name"
                class="input mb-2"
                placeholder="Enter team 1 name"
              />
              <input
                id="team1Players"
                class="input"
                placeholder="Enter team 1 players (comma separated)"
              />
            </div>
            <div class="mb-4">
              <h4 class="subtitle is-6">Team 2</h4>
              <input
                id="team2Name"
                class="input mb-2"
                placeholder="Enter team 2 name"
              />
              <input
                id="team2Players"
                class="input"
                placeholder="Enter team 2 players (comma separated)"
              />
            </div>
            <div class="mb-4">
              <label class="label">Rounds</label>
              <input id="rounds" class="input" type="number" min="1" max="10" />
            </div>
            <div class="mb-4">
              <label class="label">Time per Turn (seconds)</label>
              <input
                id="timePerTurn"
                class="input"
                type="number"
                min="30"
                max="120"
              />
            </div>
            <button class="button is-primary mt-4" onclick="startGame()">
              Start Game
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
